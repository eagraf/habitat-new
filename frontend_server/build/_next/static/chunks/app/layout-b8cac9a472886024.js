(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{274:function(e,n,t){Promise.resolve().then(t.bind(t,188)),Promise.resolve().then(t.t.bind(t,6657,23))},188:function(e,n,t){"use strict";t.d(n,{AuthProvider:function(){return d},a:function(){return _}});var o=t(5862),s=t(7058),r=t(4135),i=t(7931),a=t(7516),c=t(1125),l=t.n(c),u=e=>{let{isAuthenticated:n,handle:t,logout:s}=e;return(0,o.jsxs)("header",{className:l().header,children:[(0,o.jsx)("div",{className:l().logo,children:(0,o.jsxs)("a",{href:"/",className:l().logoLink,children:[(0,o.jsx)("span",{className:l().logo,children:"\uD83C\uDF31"}),(0,o.jsx)("span",{className:l().logo,children:" Habitat"})]})}),n&&(0,o.jsxs)("div",{className:l().userInfo,children:[t&&(0,o.jsx)("span",{className:l().handle,children:function(e){if(!e)return"";let n=e.split(".");return n.length>1?"".concat(n[0],"@").concat(n.slice(1).join(".")):e}(t)}),(0,o.jsx)("button",{className:l().logoutButton,onClick:s,children:"Logout"})]})]})};let h=(0,s.createContext)(void 0),d=e=>{let{children:n}=e,[t,c]=(0,s.useState)(!0),[l,d]=(0,s.useState)(null),_=(0,a.useRouter)();(0,s.useEffect)(()=>{c(!!r.Z.get("access_token"))},[]),(0,s.useEffect)(()=>{let e=r.Z.get("handle");e&&d(e)},[]);let f=async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let s="".concat(e,".").concat(window.location.hostname),a=await i.Z.post("".concat(window.location.origin,"/habitat/api/node/login"),{password:n,identifier:s},{headers:{"Content-Type":"application/json"}});console.log(a.data);let{accessJwt:l,refreshJwt:u,did:h,handle:f}=a.data,m=window.location.hostname;if(window.location.hostname.endsWith(".ts.net")){let e=window.location.hostname.split(".");e.length>2&&(m=e.slice(-3).join("."))}r.Z.set("access_token",l,{expires:7,domain:m}),r.Z.set("refresh_token",u,{expires:7,domain:m}),r.Z.set("habitat_domain",window.location.hostname,{expires:7,domain:m}),r.Z.set("user_did",h,{expires:7,domain:m}),r.Z.set("handle",f,{expires:7,domain:m}),c(!0),d(f),"chrome_extension"===o&&(r.Z.set("chrome_extension_user_id",h),r.Z.set("chrome_extension_access_token",l),r.Z.set("chrome_extension_refresh_token",u)),t||(t="/"),_.push(t)}catch(e){throw Error("Login failed")}},m=()=>{r.Z.remove("access_token"),r.Z.remove("refresh_token"),r.Z.remove("chrome_extension_user_id"),r.Z.remove("chrome_extension_access_token"),r.Z.remove("chrome_extension_refresh_token"),r.Z.remove("handle"),c(!1),_.push("/login")};return(0,o.jsx)(h.Provider,{value:{isAuthenticated:t,handle:l,login:f,logout:m},children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[(0,o.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,o.jsx)(u,{isAuthenticated:t,handle:l,logout:m})}),(0,o.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:n})]})})},_=()=>{let e=(0,s.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7516:function(e,n,t){"use strict";var o=t(3568);t.o(o,"useRouter")&&t.d(n,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(n,{useSearchParams:function(){return o.useSearchParams}})},6657:function(){},1125:function(e){e.exports={header:"header_header__zJOD0",logo:"header_logo__vVwaF",userInfo:"header_userInfo__Fz1qJ",handle:"header_handle__JOwNX",logoutButton:"header_logoutButton__thrgZ"}}},function(e){e.O(0,[791,533,158,660,744],function(){return e(e.s=274)}),_N_E=e.O()}]);