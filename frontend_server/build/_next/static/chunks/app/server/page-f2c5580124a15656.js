(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18],{4190:function(e,t,s){Promise.resolve().then(s.bind(s,2851))},8931:function(e,t,s){"use strict";s.d(t,{Eg:function(){return l},Mk:function(){return n},eI:function(){return o},hU:function(){return c}});var r=s(7931),a=s(4135);let n=async()=>{try{let e=a.Z.get("access_token");if(!e)throw Error("No access token found");return(await r.Z.get("".concat(window.location.origin,"/habitat/api/node"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error fetching node data:",e),e}},o=async e=>{try{let t=a.Z.get("access_token");if(!t)throw Error("No access token found");return(await r.Z.post("".concat(window.location.origin,"/habitat/api/node/users/0/apps"),e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error installing app:",e),e}},i=async()=>{try{return(await r.Z.get("".concat(window.location.origin,"/habitat/api/app_store/available_apps"))).data}catch(e){throw console.error("Error fetching available apps:",e),e}},l=async()=>{try{let e=await n(),t=Object.values(e.state.app_installations||{}).filter(e=>"web"===e.driver).map(e=>({id:e.id,name:e.name,driver:e.driver})),s=e.state.reverse_proxy_rules||{};return t.map(e=>{let t=Object.values(s).filter(t=>t.app_id===e.id).find(e=>"file"===e.type);return{...e,url:t?t.matcher:void 0}})}catch(e){throw console.error("Error fetching web apps:",e),e}},c=async()=>{try{let e=await i(),t=await n(),s=Object.values(t.state.app_installations||{});return e.map(e=>({...e,installed:s.some(t=>t.name===e.app_installation.name)}))}catch(e){throw console.error("Error fetching available apps with install status:",e),e}}},2851:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var r=s(5862),a=s(7058),n=s(7516),o=s(3268),i=s(188),l=s(8931),c=e=>{let{rules:t}=e;return(0,r.jsxs)("div",{className:"reverse-proxy-rule-list",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Reverse Proxy Rules"}),0===t.length?(0,r.jsx)("p",{children:"No reverse proxy rules found."}):(0,r.jsx)("ul",{className:"space-y-4",children:Object.entries(t).map((e,t)=>{let[s,a]=e;return(0,r.jsxs)("li",{className:"bg-white p-4 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"font-semibold",children:["Rule: ",s]}),(0,r.jsxs)("div",{children:["Type: ",a.type]}),(0,r.jsxs)("div",{children:["Target: ",a.target]}),(0,r.jsxs)("div",{children:["Matcher: ",a.matcher]}),a.app_id&&(0,r.jsxs)("div",{children:["App ID: ",a.app_id]})]},s)})})]})},d=e=>{let{apps:t,processes:s,reverseProxyRules:a}=e;return(0,r.jsxs)("div",{className:"app-list",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Habitat Apps"}),0===t.length?(0,r.jsx)("p",{children:"No apps found."}):(0,r.jsx)("ul",{className:"space-y-4",children:t.map(e=>{let t=s.find(t=>t.app_id===e.id),n=t?t.state:e.state,o=a.filter(t=>t.app_id===e.id);return(0,r.jsxs)("li",{className:"bg-white p-4 rounded-lg shadow",children:[(0,r.jsx)("div",{className:"font-semibold",children:e.name}),(0,r.jsxs)("div",{children:["State: ",n]}),o.length>0&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Access URLs:"}),(0,r.jsx)("ul",{className:"list-disc list-inside",children:o.map((e,t)=>(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"".concat(window.location.origin).concat(e.matcher),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:e.matcher})},t))})]})]},e.id)})})]})};let u=()=>{let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),{logout:s}=(0,i.a)(),[o,u]=(0,a.useState)(t.get("tab")||"apps"),[h,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=t.get("tab");e&&u(e)},[t]);let f=t=>{u(t),e.push("/server?tab=".concat(t))};return(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,l.Mk)();p(e)}catch(e){console.error("Error fetching node data:",e)}})()},[]),(0,r.jsxs)("main",{className:"flex flex-col w-full min-h-screen p-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Habitat Node State"}),(0,r.jsx)("div",{className:"flex mb-6",children:["Apps","Reverse Proxy","Users"].map(e=>(0,r.jsx)("button",{className:"px-4 py-2 mr-2 rounded-t-lg ".concat(o===e.toLowerCase().replace(" ","")?"bg-blue-500 text-white":"bg-gray-200"),onClick:()=>f(e.toLowerCase().replace(" ","")),children:e},e))}),(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:h?(()=>{let e=Object.values(h.state.processes).filter(e=>void 0!==e),t=Object.values(h.state.app_installations).filter(e=>void 0!==e),s=Object.values(h.state.reverse_proxy_rules||{}).filter(e=>void 0!==e);switch(o){case"apps":return(0,r.jsx)(d,{apps:t,processes:e,reverseProxyRules:s});case"reverseproxy":return(0,r.jsx)(c,{rules:s});case"users":return(0,r.jsx)("div",{children:"Users content goes here"});default:return null}})():(0,r.jsx)("p",{children:"Loading node data..."})})]})};var h=(0,o.Z)(()=>(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading node data..."}),children:(0,r.jsx)(u,{})}))},188:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return h},a:function(){return p}});var r=s(5862),a=s(7058),n=s(4135),o=s(7931),i=s(7516),l=s(1125),c=s.n(l),d=e=>{let{isAuthenticated:t,handle:s,logout:a}=e;return(0,r.jsxs)("header",{className:c().header,children:[(0,r.jsx)("div",{className:c().logo,children:(0,r.jsxs)("a",{href:"/",className:c().logoLink,children:[(0,r.jsx)("span",{className:c().logo,children:"\uD83C\uDF31"}),(0,r.jsx)("span",{className:c().logo,children:" Habitat"})]})}),t&&(0,r.jsxs)("div",{className:c().userInfo,children:[s&&(0,r.jsx)("span",{className:c().handle,children:function(e){if(!e)return"";let t=e.split(".");return t.length>1?"".concat(t[0],"@").concat(t.slice(1).join(".")):e}(s)}),(0,r.jsx)("button",{className:c().logoutButton,onClick:a,children:"Logout"})]})]})};let u=(0,a.createContext)(void 0),h=e=>{let{children:t}=e,[s,l]=(0,a.useState)(!0),[c,h]=(0,a.useState)(null),p=(0,i.useRouter)();(0,a.useEffect)(()=>{l(!!n.Z.get("access_token"))},[]),(0,a.useEffect)(()=>{let e=n.Z.get("handle");e&&h(e)},[]);let f=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let a="".concat(e,".").concat(window.location.hostname),i=await o.Z.post("".concat(window.location.origin,"/habitat/api/node/login"),{password:t,identifier:a},{headers:{"Content-Type":"application/json"}});console.log(i.data);let{accessJwt:c,refreshJwt:d,did:u,handle:f}=i.data,m=window.location.hostname;if(window.location.hostname.endsWith(".ts.net")){let e=window.location.hostname.split(".");e.length>2&&(m=e.slice(-3).join("."))}n.Z.set("access_token",c,{expires:7,domain:m}),n.Z.set("refresh_token",d,{expires:7,domain:m}),n.Z.set("habitat_domain",window.location.hostname,{expires:7,domain:m}),n.Z.set("user_did",u,{expires:7,domain:m}),n.Z.set("handle",f,{expires:7,domain:m}),l(!0),h(f),"chrome_extension"===r&&(n.Z.set("chrome_extension_user_id",u),n.Z.set("chrome_extension_access_token",c),n.Z.set("chrome_extension_refresh_token",d)),s||(s="/"),p.push(s)}catch(e){throw Error("Login failed")}},m=()=>{n.Z.remove("access_token"),n.Z.remove("refresh_token"),n.Z.remove("chrome_extension_user_id"),n.Z.remove("chrome_extension_access_token"),n.Z.remove("chrome_extension_refresh_token"),n.Z.remove("handle"),l(!1),p.push("/login")};return(0,r.jsx)(u.Provider,{value:{isAuthenticated:s,handle:c,login:f,logout:m},children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,r.jsx)(d,{isAuthenticated:s,handle:c,logout:m})}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:t})]})})},p=()=>{let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3268:function(e,t,s){"use strict";var r=s(5862),a=s(7058),n=s(7516),o=s(188);t.Z=e=>t=>{let{isAuthenticated:s}=(0,o.a)(),i=(0,n.useRouter)();return(0,a.useEffect)(()=>{console.log(s),s||i.push("/login")},[s,i]),(0,r.jsx)(e,{...t})}},7516:function(e,t,s){"use strict";var r=s(3568);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},1125:function(e){e.exports={header:"header_header__zJOD0",logo:"header_logo__vVwaF",userInfo:"header_userInfo__Fz1qJ",handle:"header_handle__JOwNX",logoutButton:"header_logoutButton__thrgZ"}}},function(e){e.O(0,[791,533,158,660,744],function(){return e(e.s=4190)}),_N_E=e.O()}]);