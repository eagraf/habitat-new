(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8343:function(e,t,n){Promise.resolve().then(n.bind(n,7727))},8931:function(e,t,n){"use strict";n.d(t,{Eg:function(){return l},Mk:function(){return o},eI:function(){return s},hU:function(){return c}});var r=n(7931),a=n(4135);let o=async()=>{try{let e=a.Z.get("access_token");if(!e)throw Error("No access token found");return(await r.Z.get("".concat(window.location.origin,"/habitat/api/node"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error fetching node data:",e),e}},s=async e=>{try{let t=a.Z.get("access_token");if(!t)throw Error("No access token found");return(await r.Z.post("".concat(window.location.origin,"/habitat/api/node/users/0/apps"),e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error installing app:",e),e}},i=async()=>{try{return(await r.Z.get("".concat(window.location.origin,"/habitat/api/app_store/available_apps"))).data}catch(e){throw console.error("Error fetching available apps:",e),e}},l=async()=>{try{let e=await o(),t=Object.values(e.state.app_installations||{}).filter(e=>"web"===e.driver).map(e=>({id:e.id,name:e.name,driver:e.driver})),n=e.state.reverse_proxy_rules||{};return t.map(e=>{let t=Object.values(n).filter(t=>t.app_id===e.id).find(e=>"file"===e.type);return{...e,url:t?t.matcher:void 0}})}catch(e){throw console.error("Error fetching web apps:",e),e}},c=async()=>{try{let e=await i(),t=await o(),n=Object.values(t.state.app_installations||{});return e.map(e=>({...e,installed:n.some(t=>t.name===e.app_installation.name)}))}catch(e){throw console.error("Error fetching available apps with install status:",e),e}}},7727:function(e,t,n){"use strict";n.r(t);var r=n(5862),a=n(7058),o=n(4231),s=n(3268),i=n(188),l=n(8931),c=n(7516);n(9290),t.default=(0,s.Z)(()=>{let{logout:e}=(0,i.a)(),[t,n]=a.useState([]),[s,d]=a.useState(!0);a.useEffect(()=>{(async()=>{d(!0);try{let e=(await (0,l.Eg)()).filter(e=>"web"===e.driver).map(e=>({id:e.id,name:e.name,description:"No description available",icon:"\uD83C\uDF10",link:e.url||"#"}));n(e),d(!1)}catch(e){console.error("Error fetching node state:",e)}})()},[]);let u=(0,c.useRouter)(),h=[{id:"my-server",name:"My Server",description:"Manage your server",icon:"\uD83D\uDDA5ï¸",link:"/server"},{id:"app-shop",name:"App Gallery",description:"Find apps to install on your server",icon:"\uD83C\uDF4E",link:"/app-store"},...t];return(0,r.jsx)("main",{className:"flex items-center justify-start w-full h-screen flex-col gap-4",children:(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-6 w-full max-w-4xl",children:s?(0,r.jsx)("div",{children:"Loading..."}):h.map(e=>(0,r.jsx)(o.default,{href:e.link,className:"w-64 h-64 bg-white shadow-lg rounded-lg flex items-center justify-center cursor-pointer hover:shadow-xl transition-shadow duration-300",onClick:t=>{t.preventDefault(),u.push(e.link)},children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:e.icon}),(0,r.jsx)("h2",{className:"text-xl font-semibold",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})},e.id))})})})},188:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return h},a:function(){return p}});var r=n(5862),a=n(7058),o=n(4135),s=n(7931),i=n(7516),l=n(1125),c=n.n(l),d=e=>{let{isAuthenticated:t,handle:n,logout:a}=e;return(0,r.jsxs)("header",{className:c().header,children:[(0,r.jsx)("div",{className:c().logo,children:(0,r.jsxs)("a",{href:"/",className:c().logoLink,children:[(0,r.jsx)("span",{className:c().logo,children:"\uD83C\uDF31"}),(0,r.jsx)("span",{className:c().logo,children:" Habitat"})]})}),t&&(0,r.jsxs)("div",{className:c().userInfo,children:[n&&(0,r.jsx)("span",{className:c().handle,children:function(e){if(!e)return"";let t=e.split(".");return t.length>1?"".concat(t[0],"@").concat(t.slice(1).join(".")):e}(n)}),(0,r.jsx)("button",{className:c().logoutButton,onClick:a,children:"Logout"})]})]})};let u=(0,a.createContext)(void 0),h=e=>{let{children:t}=e,[n,l]=(0,a.useState)(!0),[c,h]=(0,a.useState)(null),p=(0,i.useRouter)();(0,a.useEffect)(()=>{l(!!o.Z.get("access_token"))},[]),(0,a.useEffect)(()=>{let e=o.Z.get("handle");e&&h(e)},[]);let f=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let a="".concat(e,".").concat(window.location.hostname),i=await s.Z.post("".concat(window.location.origin,"/habitat/api/node/login"),{password:t,identifier:a},{headers:{"Content-Type":"application/json"}});console.log(i.data);let{accessJwt:c,refreshJwt:d,did:u,handle:f}=i.data,m=window.location.hostname;if(window.location.hostname.endsWith(".ts.net")){let e=window.location.hostname.split(".");e.length>2&&(m=e.slice(-3).join("."))}o.Z.set("access_token",c,{expires:7,domain:m}),o.Z.set("refresh_token",d,{expires:7,domain:m}),o.Z.set("habitat_domain",window.location.hostname,{expires:7,domain:m}),o.Z.set("user_did",u,{expires:7,domain:m}),o.Z.set("handle",f,{expires:7,domain:m}),l(!0),h(f),"chrome_extension"===r&&(o.Z.set("chrome_extension_user_id",u),o.Z.set("chrome_extension_access_token",c),o.Z.set("chrome_extension_refresh_token",d)),n||(n="/"),p.push(n)}catch(e){throw Error("Login failed")}},m=()=>{o.Z.remove("access_token"),o.Z.remove("refresh_token"),o.Z.remove("chrome_extension_user_id"),o.Z.remove("chrome_extension_access_token"),o.Z.remove("chrome_extension_refresh_token"),o.Z.remove("handle"),l(!1),p.push("/login")};return(0,r.jsx)(u.Provider,{value:{isAuthenticated:n,handle:c,login:f,logout:m},children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,r.jsx)(d,{isAuthenticated:n,handle:c,logout:m})}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:t})]})})},p=()=>{let e=(0,a.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3268:function(e,t,n){"use strict";var r=n(5862),a=n(7058),o=n(7516),s=n(188);t.Z=e=>t=>{let{isAuthenticated:n}=(0,s.a)(),i=(0,o.useRouter)();return(0,a.useEffect)(()=>{console.log(n),n||i.push("/login")},[n,i]),(0,r.jsx)(e,{...t})}},9290:function(){},1125:function(e){e.exports={header:"header_header__zJOD0",logo:"header_logo__vVwaF",userInfo:"header_userInfo__Fz1qJ",handle:"header_handle__JOwNX",logoutButton:"header_logoutButton__thrgZ"}}},function(e){e.O(0,[791,533,90,158,660,744],function(){return e(e.s=8343)}),_N_E=e.O()}]);