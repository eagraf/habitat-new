(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8944:function(e,n,t){Promise.resolve().then(t.bind(t,3114))},3114:function(e,n,t){"use strict";t.r(n);var o=t(5862),s=t(7058),r=t(7516),i=t(4872),a=t.n(i),l=t(188);let c=()=>{let[e,n]=(0,s.useState)(""),[t,i]=(0,s.useState)(""),{login:c}=(0,l.a)();(0,r.useRouter)();let u=(0,r.useSearchParams)(),d=async n=>{let o="/",s=u.get("redirectRoute");s&&(o=s);let r=u.get("source");n.preventDefault(),c(e,t,o,r)};return(0,o.jsx)("div",{className:a().loginBody,children:(0,o.jsx)("div",{className:a().loginContainer,children:(0,o.jsxs)("form",{className:a().loginForm,onSubmit:d,children:[(0,o.jsx)("h2",{children:"Login"}),(0,o.jsxs)("div",{className:a().formGroup,children:[(0,o.jsx)("label",{htmlFor:"handle",children:"Handle:"}),(0,o.jsx)("input",{type:"text",id:"handle",value:e,onChange:e=>n(e.target.value),required:!0})]}),(0,o.jsxs)("div",{className:a().formGroup,children:[(0,o.jsx)("label",{htmlFor:"password",children:"Password:"}),(0,o.jsx)("input",{type:"password",id:"password",value:t,onChange:e=>i(e.target.value),required:!0})]}),(0,o.jsx)("button",{className:a().loginButton,type:"submit",children:"Login"})]})})})};n.default=()=>(0,o.jsx)(s.Suspense,{fallback:(0,o.jsx)("div",{children:"Loading..."}),children:(0,o.jsx)(c,{})})},188:function(e,n,t){"use strict";t.d(n,{AuthProvider:function(){return h},a:function(){return m}});var o=t(5862),s=t(7058),r=t(4135),i=t(7931),a=t(7516),l=t(1125),c=t.n(l),u=e=>{let{isAuthenticated:n,handle:t,logout:s}=e;return(0,o.jsxs)("header",{className:c().header,children:[(0,o.jsx)("div",{className:c().logo,children:(0,o.jsxs)("a",{href:"/",className:c().logoLink,children:[(0,o.jsx)("span",{className:c().logo,children:"\uD83C\uDF31"}),(0,o.jsx)("span",{className:c().logo,children:" Habitat"})]})}),n&&(0,o.jsxs)("div",{className:c().userInfo,children:[t&&(0,o.jsx)("span",{className:c().handle,children:function(e){if(!e)return"";let n=e.split(".");return n.length>1?"".concat(n[0],"@").concat(n.slice(1).join(".")):e}(t)}),(0,o.jsx)("button",{className:c().logoutButton,onClick:s,children:"Logout"})]})]})};let d=(0,s.createContext)(void 0),h=e=>{let{children:n}=e,[t,l]=(0,s.useState)(!0),[c,h]=(0,s.useState)(null),m=(0,a.useRouter)();(0,s.useEffect)(()=>{l(!!r.Z.get("access_token"))},[]),(0,s.useEffect)(()=>{let e=r.Z.get("handle");e&&h(e)},[]);let _=async function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let s="".concat(e,".").concat(window.location.hostname),a=await i.Z.post("".concat(window.location.origin,"/habitat/api/node/login"),{password:n,identifier:s},{headers:{"Content-Type":"application/json"}});console.log(a.data);let{accessJwt:c,refreshJwt:u,did:d,handle:_}=a.data,f=window.location.hostname;if(window.location.hostname.endsWith(".ts.net")){let e=window.location.hostname.split(".");e.length>2&&(f=e.slice(-3).join("."))}r.Z.set("access_token",c,{expires:7,domain:f}),r.Z.set("refresh_token",u,{expires:7,domain:f}),r.Z.set("habitat_domain",window.location.hostname,{expires:7,domain:f}),r.Z.set("user_did",d,{expires:7,domain:f}),r.Z.set("handle",_,{expires:7,domain:f}),l(!0),h(_),"chrome_extension"===o&&(r.Z.set("chrome_extension_user_id",d),r.Z.set("chrome_extension_access_token",c),r.Z.set("chrome_extension_refresh_token",u)),t||(t="/"),m.push(t)}catch(e){throw Error("Login failed")}},f=()=>{r.Z.remove("access_token"),r.Z.remove("refresh_token"),r.Z.remove("chrome_extension_user_id"),r.Z.remove("chrome_extension_access_token"),r.Z.remove("chrome_extension_refresh_token"),r.Z.remove("handle"),l(!1),m.push("/login")};return(0,o.jsx)(d.Provider,{value:{isAuthenticated:t,handle:c,login:_,logout:f},children:(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[(0,o.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,o.jsx)(u,{isAuthenticated:t,handle:c,logout:f})}),(0,o.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:n})]})})},m=()=>{let e=(0,s.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7516:function(e,n,t){"use strict";var o=t(3568);t.o(o,"useRouter")&&t.d(n,{useRouter:function(){return o.useRouter}}),t.o(o,"useSearchParams")&&t.d(n,{useSearchParams:function(){return o.useSearchParams}})},4872:function(e){e.exports={loginBody:"login_loginBody__4Xe4J",loginContainer:"login_loginContainer__PJWTS",loginForm:"login_loginForm__QSvva",formGroup:"login_formGroup__caHhm",loginButton:"login_loginButton__u5Ek9"}},1125:function(e){e.exports={header:"header_header__zJOD0",logo:"header_logo__vVwaF",userInfo:"header_userInfo__Fz1qJ",handle:"header_handle__JOwNX",logoutButton:"header_logoutButton__thrgZ"}}},function(e){e.O(0,[791,533,158,660,744],function(){return e(e.s=8944)}),_N_E=e.O()}]);