(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{3121:function(e,t,n){Promise.resolve().then(n.bind(n,1232))},8931:function(e,t,n){"use strict";n.d(t,{Eg:function(){return l},Mk:function(){return s},eI:function(){return o},hU:function(){return c}});var a=n(7931),r=n(4135);let s=async()=>{try{let e=r.Z.get("access_token");if(!e)throw Error("No access token found");return(await a.Z.get("".concat(window.location.origin,"/habitat/api/node"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error fetching node data:",e),e}},o=async e=>{try{let t=r.Z.get("access_token");if(!t)throw Error("No access token found");return(await a.Z.post("".concat(window.location.origin,"/habitat/api/node/users/0/apps"),e,{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}})).data}catch(e){throw console.error("Error installing app:",e),e}},i=async()=>{try{return(await a.Z.get("".concat(window.location.origin,"/habitat/api/app_store/available_apps"))).data}catch(e){throw console.error("Error fetching available apps:",e),e}},l=async()=>{try{let e=await s(),t=Object.values(e.state.app_installations||{}).filter(e=>"web"===e.driver).map(e=>({id:e.id,name:e.name,driver:e.driver})),n=e.state.reverse_proxy_rules||{};return t.map(e=>{let t=Object.values(n).filter(t=>t.app_id===e.id).find(e=>"file"===e.type);return{...e,url:t?t.matcher:void 0}})}catch(e){throw console.error("Error fetching web apps:",e),e}},c=async()=>{try{let e=await i(),t=await s(),n=Object.values(t.state.app_installations||{});return e.map(e=>({...e,installed:n.some(t=>t.name===e.app_installation.name)}))}catch(e){throw console.error("Error fetching available apps with install status:",e),e}}},1232:function(e,t,n){"use strict";n.r(t);var a=n(5862),r=n(7058),s=n(8931),o=n(3268);t.default=(0,o.Z)(()=>{let[e,t]=(0,r.useState)([]),[n,o]=(0,r.useState)(!0),[i,l]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,s.hU)();t(e)}catch(e){console.error("Error fetching apps:",e),l("Error fetching apps. Please try again later.")}finally{o(!1)}})()},[]);let c=async e=>{try{let t=await (0,s.eI)(e);console.log("App installed successfully:",t)}catch(e){console.error("Error installing app:",e),l("Error installing app. Please try again later.")}};return n?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):i?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:i}):(0,a.jsxs)("main",{className:"flex flex-col w-full min-h-screen p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"App Store"}),(0,a.jsx)("div",{children:e.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-white",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:e.app_installation.name}),(0,a.jsxs)("p",{className:"text-gray-600 mb-2",children:["Version: ",e.app_installation.version]}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["Driver: ",e.app_installation.driver]}),e.installed?(0,a.jsx)("button",{className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors",disabled:!0,children:"Installed"}):(0,a.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors",onClick:()=>c(e),children:"Install"})]},e.app_installation.id))})]})})},188:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return h},a:function(){return p}});var a=n(5862),r=n(7058),s=n(4135),o=n(7931),i=n(7516),l=n(1125),c=n.n(l),u=e=>{let{isAuthenticated:t,handle:n,logout:r}=e;return(0,a.jsxs)("header",{className:c().header,children:[(0,a.jsx)("div",{className:c().logo,children:(0,a.jsxs)("a",{href:"/",className:c().logoLink,children:[(0,a.jsx)("span",{className:c().logo,children:"\uD83C\uDF31"}),(0,a.jsx)("span",{className:c().logo,children:" Habitat"})]})}),t&&(0,a.jsxs)("div",{className:c().userInfo,children:[n&&(0,a.jsx)("span",{className:c().handle,children:function(e){if(!e)return"";let t=e.split(".");return t.length>1?"".concat(t[0],"@").concat(t.slice(1).join(".")):e}(n)}),(0,a.jsx)("button",{className:c().logoutButton,onClick:r,children:"Logout"})]})]})};let d=(0,r.createContext)(void 0),h=e=>{let{children:t}=e,[n,l]=(0,r.useState)(!0),[c,h]=(0,r.useState)(null),p=(0,i.useRouter)();(0,r.useEffect)(()=>{l(!!s.Z.get("access_token"))},[]),(0,r.useEffect)(()=>{let e=s.Z.get("handle");e&&h(e)},[]);let f=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{let r="".concat(e,".").concat(window.location.hostname),i=await o.Z.post("".concat(window.location.origin,"/habitat/api/node/login"),{password:t,identifier:r},{headers:{"Content-Type":"application/json"}});console.log(i.data);let{accessJwt:c,refreshJwt:u,did:d,handle:f}=i.data,m=window.location.hostname;if(window.location.hostname.endsWith(".ts.net")){let e=window.location.hostname.split(".");e.length>2&&(m=e.slice(-3).join("."))}s.Z.set("access_token",c,{expires:7,domain:m}),s.Z.set("refresh_token",u,{expires:7,domain:m}),s.Z.set("habitat_domain",window.location.hostname,{expires:7,domain:m}),s.Z.set("user_did",d,{expires:7,domain:m}),s.Z.set("handle",f,{expires:7,domain:m}),l(!0),h(f),"chrome_extension"===a&&(s.Z.set("chrome_extension_user_id",d),s.Z.set("chrome_extension_access_token",c),s.Z.set("chrome_extension_refresh_token",u)),n||(n="/"),p.push(n)}catch(e){throw Error("Login failed")}},m=()=>{s.Z.remove("access_token"),s.Z.remove("refresh_token"),s.Z.remove("chrome_extension_user_id"),s.Z.remove("chrome_extension_access_token"),s.Z.remove("chrome_extension_refresh_token"),s.Z.remove("handle"),l(!1),p.push("/login")};return(0,a.jsx)(d.Provider,{value:{isAuthenticated:n,handle:c,login:f,logout:m},children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:[(0,a.jsx)("div",{className:"flex flex-col items-center justify-center w-full",children:(0,a.jsx)(u,{isAuthenticated:n,handle:c,logout:m})}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-screen",children:t})]})})},p=()=>{let e=(0,r.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3268:function(e,t,n){"use strict";var a=n(5862),r=n(7058),s=n(7516),o=n(188);t.Z=e=>t=>{let{isAuthenticated:n}=(0,o.a)(),i=(0,s.useRouter)();return(0,r.useEffect)(()=>{console.log(n),n||i.push("/login")},[n,i]),(0,a.jsx)(e,{...t})}},7516:function(e,t,n){"use strict";var a=n(3568);n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},1125:function(e){e.exports={header:"header_header__zJOD0",logo:"header_logo__vVwaF",userInfo:"header_userInfo__Fz1qJ",handle:"header_handle__JOwNX",logoutButton:"header_logoutButton__thrgZ"}}},function(e){e.O(0,[791,533,158,660,744],function(){return e(e.s=3121)}),_N_E=e.O()}]);